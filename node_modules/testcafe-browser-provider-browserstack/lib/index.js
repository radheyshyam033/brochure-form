"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const url_1 = require("url");
const pinkie_1 = __importDefault(require("pinkie"));
const util_1 = require("util");
const desired_capabilities_1 = __importDefault(require("desired-capabilities"));
const lodash_1 = require("lodash");
const connector_1 = __importDefault(require("./connector"));
const js_testing_1 = __importDefault(require("./backends/js-testing"));
const automate_1 = __importDefault(require("./backends/automate"));
const browser_proxy_1 = __importDefault(require("./browser-proxy"));
const is_env_var_true_1 = __importDefault(require("./utils/is-env-var-true"));
const mime_db_1 = __importDefault(require("mime-db"));
const ANDROID_PROXY_RESPONSE_DELAY = 500;
const isAutomateEnabled = () => is_env_var_true_1.default('BROWSERSTACK_USE_AUTOMATE');
const isLocalEnabled = () => !!process.env.BROWSERSTACK_LOCAL_IDENTIFIER || !is_env_var_true_1.default('BROWSERSTACK_NO_LOCAL');
function getMimeTypes() {
    const mimeTypes = Object.keys(mime_db_1.default);
    return mimeTypes.filter(mimeType => {
        const { extensions } = mime_db_1.default[mimeType];
        return extensions && extensions.length;
    }).join(',');
}
module.exports = {
    // Multiple browsers support
    isMultiBrowser: true,
    backend: null,
    connectorPromise: pinkie_1.default.resolve(null),
    browserProxyPromise: pinkie_1.default.resolve(null),
    workers: {},
    platformsInfo: [],
    browserNames: [],
    _createConnector() {
        this.connectorPromise = this.connectorPromise
            .then(async (connector) => {
            if (!connector) {
                connector = new connector_1.default(process.env['BROWSERSTACK_ACCESS_KEY']);
                await connector.create();
            }
            return connector;
        });
        return this.connectorPromise;
    },
    _disposeConnector() {
        this.connectorPromise = this.connectorPromise
            .then(async (connector) => {
            if (connector)
                await connector.destroy();
            return null;
        });
        return this.connectorPromise;
    },
    _getBrowserProxy(host, port) {
        this.browserProxyPromise = this.browserProxyPromise
            .then(async (browserProxy) => {
            if (!browserProxy) {
                browserProxy = new browser_proxy_1.default(host, port, { responseDelay: ANDROID_PROXY_RESPONSE_DELAY });
                await browserProxy.init();
            }
            return browserProxy;
        });
        return this.browserProxyPromise;
    },
    _disposeBrowserProxy() {
        this.browserProxyPromise = this.browserProxyPromise
            .then(async (browserProxy) => {
            if (browserProxy)
                await browserProxy.dispose();
            return null;
        });
        return this.browserProxyPromise;
    },
    async _getDeviceList() {
        this.platformsInfo = await this.backend.getBrowsersList();
    },
    _createQuery(capabilities) {
        var { browserName, browserVersion, platform } = desired_capabilities_1.default(capabilities)[0];
        browserName = browserName.toLowerCase();
        if (browserName === 'internet explorer')
            browserName = 'ie';
        return {
            name: browserName,
            version: browserVersion.toLowerCase(),
            platform: platform.toLowerCase()
        };
    },
    _generateBasicCapabilities(browserName) {
        return this._filterPlatformInfo(this._createQuery(browserName))[0];
    },
    _getCapabilitiesFromEnvironment() {
        // NOTE: This function maps env vars to browserstack capabilities.
        // For the full list of capabilities, see https://www.browserstack.com/automate/capabilities
        return {
            'build': process.env['BROWSERSTACK_BUILD_ID'],
            'project': process.env['BROWSERSTACK_PROJECT_NAME'],
            'resolution': process.env['BROWSERSTACK_DISPLAY_RESOLUTION'],
            'name': process.env['BROWSERSTACK_TEST_RUN_NAME'],
            'browserstack.debug': process.env['BROWSERSTACK_DEBUG'],
            'browserstack.console': process.env['BROWSERSTACK_CONSOLE'],
            'browserstack.networkLogs': process.env['BROWSERSTACK_NETWORK_LOGS'],
            'browserstack.video': process.env['BROWSERSTACK_VIDEO'],
            'browserstack.timezone': process.env['BROWSERSTACK_TIMEZONE'],
            'browserstack.geoLocation': process.env['BROWSERSTACK_GEO_LOCATION'],
            'browserstack.customNetwork': process.env['BROWSERSTACK_CUSTOM_NETWORK'],
            'browserstack.networkProfile': process.env['BROWSERSTACK_NETWORK_PROFILE'],
            'acceptSslCerts': process.env['BROWSERSTACK_ACCEPT_SSL_CERTS']
        };
    },
    _getCapabilitiesFromConfig() {
        const configPath = process.env.BROWSERSTACK_CAPABILITIES_CONFIG_PATH;
        if (!configPath)
            return {};
        return require(configPath);
    },
    _getAdditionalCapabilities() {
        const capabilitiesFromEnvironment = lodash_1.pickBy(this._getCapabilitiesFromEnvironment(), value => value !== void 0);
        return Object.assign(Object.assign({}, this._getCapabilitiesFromConfig()), capabilitiesFromEnvironment);
    },
    _filterPlatformInfo(query) {
        let filteredPlatformInfo = this.platformsInfo
            .filter(info => {
            var browserNameMatched = info['browser'] && info['browser'].toLowerCase() === query.name;
            var deviceNameMatched = info['device'] && info['device'].toLowerCase() === query.name;
            var browserVersionMatched = info['browser_version'] && String(info['browser_version']) === String(query.version);
            var platformVersionMatched = info['os_version'] && String(info['os_version']).toLowerCase() === String(query.version);
            var platformNameMatched = info['os'].toLowerCase() === query.platform ||
                `${info['os'].toLowerCase()} ${info['os_version'].toLowerCase()}` === query.platform;
            var isAnyVersion = query.version === 'any';
            var isAnyPlatform = query.platform === 'any';
            var desktopBrowserMatched = browserNameMatched &&
                (browserVersionMatched || isAnyVersion) &&
                (platformNameMatched || isAnyPlatform);
            var mobileBrowserMatched = deviceNameMatched &&
                (platformVersionMatched || isAnyVersion);
            return desktopBrowserMatched || mobileBrowserMatched;
        });
        if (filteredPlatformInfo.length && query.version === 'any') {
            filteredPlatformInfo = filteredPlatformInfo.filter(info => {
                const browserVersion = info['browser_version'] || '';
                return !browserVersion.includes('beta');
            });
        }
        return filteredPlatformInfo;
    },
    _generateBrowserNames() {
        this.browserNames = this.platformsInfo
            .map(info => {
            var isDesktop = !info['device'];
            var name = isDesktop ? info['browser'] : info['device'];
            var version = isDesktop ? info['browser_version'] : info['os_version'];
            var platform = isDesktop ? `${info['os']} ${info['os_version']}` : '';
            return `${name}@${version}${platform ? ':' + platform : ''}`;
        });
    },
    _prepareChromeCapabilities(capabilities) {
        if (process.env['BROWSERSTACK_CHROME_ARGS'] && process.env['BROWSERSTACK_CHROME_ARGS'].length > 0)
            capabilities.chromeOptions = { args: [process.env['BROWSERSTACK_CHROME_ARGS']] };
    },
    async _prepareFirefoxCapabilities(capabilities) {
        if (!process.env['BROWSERSTACK_USE_AUTOMATE'])
            return;
        const FirefoxProfile = require('firefox-profile');
        const profile = new FirefoxProfile();
        profile.defaultPreferences = {};
        profile.setPreference('browser.helperApps.neverAsk.saveToDisk', getMimeTypes());
        profile.updatePreferences();
        capabilities['firefox_profile'] = await util_1.promisify(profile.encoded).bind(profile)();
    },
    async _encodeFirefoxProfile(profile) {
        return new pinkie_1.default((resolve, reject) => {
            profile.encoded(function (err, encodedProfile) {
                if (err)
                    reject(err);
                else
                    resolve(encodedProfile);
            });
        });
    },
    // Required - must be implemented
    // Browser control
    async openBrowser(id, pageUrl, browserName) {
        const capabilities = Object.assign(Object.assign({}, this._generateBasicCapabilities(browserName)), this._getAdditionalCapabilities());
        capabilities.local = isLocalEnabled();
        // Give preference to the already running local identifier
        capabilities.localIdentifier = process.env.BROWSERSTACK_LOCAL_IDENTIFIER;
        if (capabilities.local && !capabilities.localIdentifier) {
            const connector = await this._createConnector();
            capabilities.localIdentifier = connector.connectorInstance.localIdentifierFlag;
        }
        if (capabilities.os.toLowerCase() === 'android') {
            const parsedPageUrl = url_1.parse(pageUrl);
            const browserProxy = await this._getBrowserProxy(parsedPageUrl.hostname, parsedPageUrl.port);
            pageUrl = 'http://' + browserProxy.targetHost + ':' + browserProxy.proxyPort + parsedPageUrl.path;
        }
        if (!capabilities.name)
            capabilities.name = `TestCafe test run ${id}`;
        if (browserName.includes('chrome'))
            this._prepareChromeCapabilities(capabilities);
        if (browserName.includes('firefox'))
            await this._prepareFirefoxCapabilities(capabilities);
        await this.backend.openBrowser(id, pageUrl, capabilities);
        this.setUserAgentMetaInfo(id, this.backend.getSessionUrl(id));
    },
    async closeBrowser(id) {
        await this.backend.closeBrowser(id);
    },
    // Optional - implement methods you need, remove other methods
    // Initialization
    async init() {
        var reportWarning = (...args) => this.reportWarning(...args);
        this.backend = isAutomateEnabled() ? new automate_1.default(reportWarning) : new js_testing_1.default(reportWarning);
        await this._getDeviceList();
        this._generateBrowserNames();
    },
    async dispose() {
        await this._disposeConnector();
        await this._disposeBrowserProxy();
    },
    // Browser names handling
    async getBrowserList() {
        return this.browserNames;
    },
    async isValidBrowserName(browserName) {
        return desired_capabilities_1.default(browserName).length === 1 && !!this._filterPlatformInfo(this._createQuery(browserName)).length;
    },
    // Extra methods
    async resizeWindow(id, width, height, currentWidth, currentHeight) {
        await this.backend.resizeWindow(id, width, height, currentWidth, currentHeight);
    },
    async maximizeWindow(id) {
        await this.backend.maximizeWindow(id);
    },
    async takeScreenshot(id, screenshotPath) {
        await this.backend.takeScreenshot(id, screenshotPath);
    },
    async reportJobResult(id, jobResult, jobData) {
        await this.backend.reportJobResult(id, jobResult, jobData, this.JOB_RESULT);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw2QkFBd0M7QUFDeEMsb0RBQTZCO0FBQzdCLCtCQUFpQztBQUNqQyxnRkFBcUQ7QUFDckQsbUNBQWdDO0FBQ2hDLDREQUFnRDtBQUNoRCx1RUFBcUQ7QUFDckQsbUVBQWtEO0FBQ2xELG9FQUEyQztBQUMzQyw4RUFBbUQ7QUFDbkQsc0RBQXlCO0FBRXpCLE1BQU0sNEJBQTRCLEdBQUcsR0FBRyxDQUFDO0FBRXpDLE1BQU0saUJBQWlCLEdBQUcsR0FBRyxFQUFFLENBQUMseUJBQVksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBQzFFLE1BQU0sY0FBYyxHQUFNLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLDZCQUE2QixJQUFJLENBQUMseUJBQVksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRXRILFNBQVMsWUFBWTtJQUNqQixNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFFLENBQUMsQ0FBQztJQUVsQyxPQUFPLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUU7UUFDL0IsTUFBTSxFQUFFLFVBQVUsRUFBRSxHQUFHLGlCQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFcEMsT0FBTyxVQUFVLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQztJQUMzQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDakIsQ0FBQztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUc7SUFDYiw0QkFBNEI7SUFDNUIsY0FBYyxFQUFFLElBQUk7SUFFcEIsT0FBTyxFQUFFLElBQUk7SUFFYixnQkFBZ0IsRUFBSyxnQkFBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDMUMsbUJBQW1CLEVBQUUsZ0JBQU8sQ0FBQyxPQUFPLENBQUMsSUFB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QUVELEtBQUssQ0FBQyxlQUFlLENBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxPQUFPO1FBQ3pDLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2hGLENBQUM7Q0FDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGFyc2UgYXMgcGFyc2VVcmwgfSBmcm9tICd1cmwnO1xuaW1wb3J0IFByb21pc2UgZnJvbSAncGlua2llJztcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IHBhcnNlQ2FwYWJpbGl0aWVzIGZyb20gJ2Rlc2lyZWQtY2FwYWJpbGl0aWVzJztcbmltcG9ydCB7IHBpY2tCeSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQnJvd3NlcnN0YWNrQ29ubmVjdG9yIGZyb20gJy4vY29ubmVjdG9yJztcbmltcG9ydCBKU1Rlc3RpbmdCYWNrZW5kIGZyb20gJy4vYmFja2VuZHMvanMtdGVzdGluZyc7XG5pbXBvcnQgQXV0b21hdGVCYWNrZW5kIGZyb20gJy4vYmFja2VuZHMvYXV0b21hdGUnO1xuaW1wb3J0IEJyb3dzZXJQcm94eSBmcm9tICcuL2Jyb3dzZXItcHJveHknO1xuaW1wb3J0IGlzRW52VmFyVHJ1ZSBmcm9tICcuL3V0aWxzL2lzLWVudi12YXItdHJ1ZSc7XG5pbXBvcnQgZGIgZnJvbSAnbWltZS1kYic7XG5cbmNvbnN0IEFORFJPSURfUFJPWFlfUkVTUE9OU0VfREVMQVkgPSA1MDA7XG5cbmNvbnN0IGlzQXV0b21hdGVFbmFibGVkID0gKCkgPT4gaXNFbnZWYXJUcnVlKCdCUk9XU0VSU1RBQ0tfVVNFX0FVVE9NQVRFJyk7XG5jb25zdCBpc0xvY2FsRW5hYmxlZCAgICA9ICgpID0+ICEhcHJvY2Vzcy5lbnYuQlJPV1NFUlNUQUNLX0xPQ0FMX0lERU5USUZJRVIgfHwgIWlzRW52VmFyVHJ1ZSgnQlJPV1NFUlNUQUNLX05PX0xPQ0FMJyk7XG5cbmZ1bmN0aW9uIGdldE1pbWVUeXBlcyAoKSB7XG4gICAgY29uc3QgbWltZVR5cGVzID0gT2JqZWN0LmtleXMoZGIpO1xuXG4gICAgcmV0dXJuIG1pbWVUeXBlcy5maWx0ZXIobWltZVR5cGUgPT4ge1xuICAgICAgICBjb25zdCB7IGV4dGVuc2lvbnMgfSA9IGRiW21pbWVUeXBlXTtcblxuICAgICAgICByZXR1cm4gZXh0ZW5zaW9ucyAmJiBleHRlbnNpb25zLmxlbmd0aDtcbiAgICB9KS5qb2luKCcsJyk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIC8vIE11bHRpcGxlIGJyb3dzZXJzIHN1cHBvcnRcbiAgICBpc011bHRpQnJvd3NlcjogdHJ1ZSxcblxuICAgIGJhY2tlbmQ6IG51bGwsXG5cbiAgICBjb25uZWN0b3JQcm9taXNlOiAgICBQcm9taXNlLnJlc29sdmUobnVsbCksXG4gICAgYnJvd3NlclByb3h5UHJvbWlzZTogUHJvbWlzZS5yZXNvbHZlKG51bGwpLFxuXG4gICAgd29ya2VyczogICAgICAge30sXG4gICAgcGxhdGZvcm1zSW5mbzogW10sXG4gICAgYnJvd3Nlck5hbWVzOiAgW10sXG5cbiAgICBfY3JlYXRlQ29ubmVjdG9yICgpIHtcbiAgICAgICAgdGhpcy5jb25uZWN0b3JQcm9taXNlID0gdGhpcy5jb25uZWN0b3JQcm9taXNlXG4gICAgICAgICAgICAudGhlbihhc3luYyBjb25uZWN0b3IgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghY29ubmVjdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3RvciA9IG5ldyBCcm93c2Vyc3RhY2tDb25uZWN0b3IocHJvY2Vzcy5lbnZbJ0JST1dTRVJTVEFDS19BQ0NFU1NfS0VZJ10pO1xuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rvci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gY29ubmVjdG9yO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdG9yUHJvbWlzZTtcbiAgICB9LFxuXG4gICAgX2Rpc3Bvc2VDb25uZWN0b3IgKCkge1xuICAgICAgICB0aGlzLmNvbm5lY3RvclByb21pc2UgPSB0aGlzLmNvbm5lY3RvclByb21pc2VcbiAgICAgICAgICAgIC50aGVuKGFzeW5jIGNvbm5lY3RvciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbm5lY3RvcilcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdG9yLmRlc3Ryb3koKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdG9yUHJvbWlzZTtcbiAgICB9LFxuXG4gICAgX2dldEJyb3dzZXJQcm94eSAoaG9zdCwgcG9ydCkge1xuICAgICAgICB0aGlzLmJyb3dzZXJQcm94eVByb21pc2UgPSB0aGlzLmJyb3dzZXJQcm94eVByb21pc2VcbiAgICAgICAgICAgIC50aGVuKGFzeW5jIGJyb3dzZXJQcm94eSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFicm93c2VyUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJvd3NlclByb3h5ID0gbmV3IEJyb3dzZXJQcm94eShob3N0LCBwb3J0LCB7IHJlc3BvbnNlRGVsYXk6IEFORFJPSURfUFJPWFlfUkVTUE9OU0VfREVMQVkgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYnJvd3NlclByb3h5LmluaXQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYnJvd3NlclByb3h5O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYnJvd3NlclByb3h5UHJvbWlzZTtcbiAgICB9LFxuXG4gICAgX2Rpc3Bvc2VCcm93c2VyUHJveHkgKCkge1xuICAgICAgICB0aGlzLmJyb3dzZXJQcm94eVByb21pc2UgPSB0aGlzLmJyb3dzZXJQcm94eVByb21pc2VcbiAgICAgICAgICAgIC50aGVuKGFzeW5jIGJyb3dzZXJQcm94eSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGJyb3dzZXJQcm94eSlcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYnJvd3NlclByb3h5LmRpc3Bvc2UoKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYnJvd3NlclByb3h5UHJvbWlzZTtcbiAgICB9LFxuXG4gICAgYXN5bmMgX2dldERldmljZUxpc3QgKCkge1xuICAgICAgICB0aGlzLnBsYXRmb3Jtc0luZm8gPSBhd2FpdCB0aGlzLmJhY2tlbmQuZ2V0QnJvd3NlcnNMaXN0KCk7XG4gICAgfSxcblxuICAgIF9jcmVhdGVRdWVyeSAoY2FwYWJpbGl0aWVzKSB7XG4gICAgICAgIHZhciB7IGJyb3dzZXJOYW1lLCBicm93c2VyVmVyc2lvbiwgcGxhdGZvcm0gfSA9IHBhcnNlQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllcylbMF07XG5cbiAgICAgICAgYnJvd3Nlck5hbWUgPSBicm93c2VyTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIGlmIChicm93c2VyTmFtZSA9PT0gJ2ludGVybmV0IGV4cGxvcmVyJylcbiAgICAgICAgICAgIGJyb3dzZXJOYW1lID0gJ2llJztcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogICAgIGJyb3dzZXJOYW1lLFxuICAgICAgICAgICAgdmVyc2lvbjogIGJyb3dzZXJWZXJzaW9uLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBwbGF0Zm9ybTogcGxhdGZvcm0udG9Mb3dlckNhc2UoKVxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBfZ2VuZXJhdGVCYXNpY0NhcGFiaWxpdGllcyAoYnJvd3Nlck5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbHRlclBsYXRmb3JtSW5mbyh0aGlzLl9jcmVhdGVRdWVyeShicm93c2VyTmFtZSkpWzBdO1xuICAgIH0sXG5cbiAgICBfZ2V0Q2FwYWJpbGl0aWVzRnJvbUVudmlyb25tZW50ICgpIHtcbiAgICAgICAgLy8gTk9URTogVGhpcyBmdW5jdGlvbiBtYXBzIGVudiB2YXJzIHRvIGJyb3dzZXJzdGFjayBjYXBhYmlsaXRpZXMuXG4gICAgICAgIC8vIEZvciB0aGUgZnVsbCBsaXN0IG9mIGNhcGFiaWxpdGllcywgc2VlIGh0dHBzOi8vd3d3LmJyb3dzZXJzdGFjay5jb20vYXV0b21hdGUvY2FwYWJpbGl0aWVzXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICdidWlsZCc6ICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX0JVSUxEX0lEJ10sXG4gICAgICAgICAgICAncHJvamVjdCc6ICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnZbJ0JST1dTRVJTVEFDS19QUk9KRUNUX05BTUUnXSxcbiAgICAgICAgICAgICdyZXNvbHV0aW9uJzogICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX0RJU1BMQVlfUkVTT0xVVElPTiddLFxuICAgICAgICAgICAgJ25hbWUnOiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52WydCUk9XU0VSU1RBQ0tfVEVTVF9SVU5fTkFNRSddLFxuICAgICAgICAgICAgJ2Jyb3dzZXJzdGFjay5kZWJ1Zyc6ICAgICAgICAgIHByb2Nlc3MuZW52WydCUk9XU0VSU1RBQ0tfREVCVUcnXSxcbiAgICAgICAgICAgICdicm93c2Vyc3RhY2suY29uc29sZSc6ICAgICAgICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX0NPTlNPTEUnXSxcbiAgICAgICAgICAgICdicm93c2Vyc3RhY2submV0d29ya0xvZ3MnOiAgICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX05FVFdPUktfTE9HUyddLFxuICAgICAgICAgICAgJ2Jyb3dzZXJzdGFjay52aWRlbyc6ICAgICAgICAgIHByb2Nlc3MuZW52WydCUk9XU0VSU1RBQ0tfVklERU8nXSxcbiAgICAgICAgICAgICdicm93c2Vyc3RhY2sudGltZXpvbmUnOiAgICAgICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX1RJTUVaT05FJ10sXG4gICAgICAgICAgICAnYnJvd3NlcnN0YWNrLmdlb0xvY2F0aW9uJzogICAgcHJvY2Vzcy5lbnZbJ0JST1dTRVJTVEFDS19HRU9fTE9DQVRJT04nXSxcbiAgICAgICAgICAgICdicm93c2Vyc3RhY2suY3VzdG9tTmV0d29yayc6ICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX0NVU1RPTV9ORVRXT1JLJ10sXG4gICAgICAgICAgICAnYnJvd3NlcnN0YWNrLm5ldHdvcmtQcm9maWxlJzogcHJvY2Vzcy5lbnZbJ0JST1dTRVJTVEFDS19ORVRXT1JLX1BST0ZJTEUnXSxcbiAgICAgICAgICAgICdhY2NlcHRTc2xDZXJ0cyc6ICAgICAgICAgICAgICBwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX0FDQ0VQVF9TU0xfQ0VSVFMnXVxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBfZ2V0Q2FwYWJpbGl0aWVzRnJvbUNvbmZpZyAoKSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ1BhdGggPSBwcm9jZXNzLmVudi5CUk9XU0VSU1RBQ0tfQ0FQQUJJTElUSUVTX0NPTkZJR19QQVRIO1xuXG4gICAgICAgIGlmICghY29uZmlnUGF0aClcbiAgICAgICAgICAgIHJldHVybiB7fTtcblxuICAgICAgICByZXR1cm4gcmVxdWlyZShjb25maWdQYXRoKTtcbiAgICB9LFxuXG4gICAgX2dldEFkZGl0aW9uYWxDYXBhYmlsaXRpZXMgKCkge1xuICAgICAgICBjb25zdCBjYXBhYmlsaXRpZXNGcm9tRW52aXJvbm1lbnQgPSBwaWNrQnkodGhpcy5fZ2V0Q2FwYWJpbGl0aWVzRnJvbUVudmlyb25tZW50KCksIHZhbHVlID0+IHZhbHVlICE9PSB2b2lkIDApO1xuXG4gICAgICAgIHJldHVybiB7IC4uLnRoaXMuX2dldENhcGFiaWxpdGllc0Zyb21Db25maWcoKSwgLi4uY2FwYWJpbGl0aWVzRnJvbUVudmlyb25tZW50IH07XG4gICAgfSxcblxuICAgIF9maWx0ZXJQbGF0Zm9ybUluZm8gKHF1ZXJ5KSB7XG4gICAgICAgIGxldCBmaWx0ZXJlZFBsYXRmb3JtSW5mbyA9IHRoaXMucGxhdGZvcm1zSW5mb1xuICAgICAgICAgICAgLmZpbHRlcihpbmZvID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgYnJvd3Nlck5hbWVNYXRjaGVkID0gaW5mb1snYnJvd3NlciddICYmIGluZm9bJ2Jyb3dzZXInXS50b0xvd2VyQ2FzZSgpID09PSBxdWVyeS5uYW1lO1xuICAgICAgICAgICAgICAgIHZhciBkZXZpY2VOYW1lTWF0Y2hlZCAgPSBpbmZvWydkZXZpY2UnXSAmJiBpbmZvWydkZXZpY2UnXS50b0xvd2VyQ2FzZSgpID09PSBxdWVyeS5uYW1lO1xuXG4gICAgICAgICAgICAgICAgdmFyIGJyb3dzZXJWZXJzaW9uTWF0Y2hlZCAgPSBpbmZvWydicm93c2VyX3ZlcnNpb24nXSAmJiBTdHJpbmcoaW5mb1snYnJvd3Nlcl92ZXJzaW9uJ10pID09PSBTdHJpbmcocXVlcnkudmVyc2lvbik7XG4gICAgICAgICAgICAgICAgdmFyIHBsYXRmb3JtVmVyc2lvbk1hdGNoZWQgPSBpbmZvWydvc192ZXJzaW9uJ10gJiYgU3RyaW5nKGluZm9bJ29zX3ZlcnNpb24nXSkudG9Mb3dlckNhc2UoKSA9PT0gU3RyaW5nKHF1ZXJ5LnZlcnNpb24pO1xuICAgICAgICAgICAgICAgIHZhciBwbGF0Zm9ybU5hbWVNYXRjaGVkICAgID0gaW5mb1snb3MnXS50b0xvd2VyQ2FzZSgpID09PSBxdWVyeS5wbGF0Zm9ybSB8fFxuICAgICAgICAgICAgICAgICAgICBgJHtpbmZvWydvcyddLnRvTG93ZXJDYXNlKCl9ICR7aW5mb1snb3NfdmVyc2lvbiddLnRvTG93ZXJDYXNlKCl9YCA9PT0gcXVlcnkucGxhdGZvcm07XG5cbiAgICAgICAgICAgICAgICB2YXIgaXNBbnlWZXJzaW9uICA9IHF1ZXJ5LnZlcnNpb24gPT09ICdhbnknO1xuICAgICAgICAgICAgICAgIHZhciBpc0FueVBsYXRmb3JtID0gcXVlcnkucGxhdGZvcm0gPT09ICdhbnknO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRlc2t0b3BCcm93c2VyTWF0Y2hlZCA9IGJyb3dzZXJOYW1lTWF0Y2hlZCAmJlxuICAgICAgICAgICAgICAgICAgICAoYnJvd3NlclZlcnNpb25NYXRjaGVkIHx8IGlzQW55VmVyc2lvbikgJiZcbiAgICAgICAgICAgICAgICAgICAgKHBsYXRmb3JtTmFtZU1hdGNoZWQgfHwgaXNBbnlQbGF0Zm9ybSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbW9iaWxlQnJvd3Nlck1hdGNoZWQgPSBkZXZpY2VOYW1lTWF0Y2hlZCAmJlxuICAgICAgICAgICAgICAgICAgICAocGxhdGZvcm1WZXJzaW9uTWF0Y2hlZCB8fCBpc0FueVZlcnNpb24pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlc2t0b3BCcm93c2VyTWF0Y2hlZCB8fCBtb2JpbGVCcm93c2VyTWF0Y2hlZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChmaWx0ZXJlZFBsYXRmb3JtSW5mby5sZW5ndGggJiYgcXVlcnkudmVyc2lvbiA9PT0gJ2FueScpIHtcbiAgICAgICAgICAgIGZpbHRlcmVkUGxhdGZvcm1JbmZvID0gZmlsdGVyZWRQbGF0Zm9ybUluZm8uZmlsdGVyKGluZm8gPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJyb3dzZXJWZXJzaW9uID0gaW5mb1snYnJvd3Nlcl92ZXJzaW9uJ10gfHwgJyc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gIWJyb3dzZXJWZXJzaW9uLmluY2x1ZGVzKCdiZXRhJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFBsYXRmb3JtSW5mbztcbiAgICB9LFxuXG4gICAgX2dlbmVyYXRlQnJvd3Nlck5hbWVzICgpIHtcbiAgICAgICAgdGhpcy5icm93c2VyTmFtZXMgPSB0aGlzLnBsYXRmb3Jtc0luZm9cbiAgICAgICAgICAgIC5tYXAoaW5mbyA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGlzRGVza3RvcCA9ICFpbmZvWydkZXZpY2UnXTtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSAgICAgID0gaXNEZXNrdG9wID8gaW5mb1snYnJvd3NlciddIDogaW5mb1snZGV2aWNlJ107XG4gICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gICA9IGlzRGVza3RvcCA/IGluZm9bJ2Jyb3dzZXJfdmVyc2lvbiddIDogaW5mb1snb3NfdmVyc2lvbiddO1xuICAgICAgICAgICAgICAgIHZhciBwbGF0Zm9ybSAgPSBpc0Rlc2t0b3AgPyBgJHtpbmZvWydvcyddfSAke2luZm9bJ29zX3ZlcnNpb24nXX1gIDogJyc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7bmFtZX1AJHt2ZXJzaW9ufSR7cGxhdGZvcm0gPyAnOicgKyBwbGF0Zm9ybSA6ICcnfWA7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgX3ByZXBhcmVDaHJvbWVDYXBhYmlsaXRpZXMgKGNhcGFiaWxpdGllcykge1xuICAgICAgICBpZiAocHJvY2Vzcy5lbnZbJ0JST1dTRVJTVEFDS19DSFJPTUVfQVJHUyddICYmIHByb2Nlc3MuZW52WydCUk9XU0VSU1RBQ0tfQ0hST01FX0FSR1MnXS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgY2FwYWJpbGl0aWVzLmNocm9tZU9wdGlvbnMgPSB7IGFyZ3M6IFtwcm9jZXNzLmVudlsnQlJPV1NFUlNUQUNLX0NIUk9NRV9BUkdTJ11dIH07XG4gICAgfSxcblxuICAgIGFzeW5jIF9wcmVwYXJlRmlyZWZveENhcGFiaWxpdGllcyAoY2FwYWJpbGl0aWVzKSB7XG4gICAgICAgIGlmICghcHJvY2Vzcy5lbnZbJ0JST1dTRVJTVEFDS19VU0VfQVVUT01BVEUnXSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBjb25zdCBGaXJlZm94UHJvZmlsZSA9IHJlcXVpcmUoJ2ZpcmVmb3gtcHJvZmlsZScpO1xuICAgICAgICBjb25zdCBwcm9maWxlICAgICAgICA9IG5ldyBGaXJlZm94UHJvZmlsZSgpO1xuXG4gICAgICAgIHByb2ZpbGUuZGVmYXVsdFByZWZlcmVuY2VzID0ge307XG5cbiAgICAgICAgcHJvZmlsZS5zZXRQcmVmZXJlbmNlKCdicm93c2VyLmhlbHBlckFwcHMubmV2ZXJBc2suc2F2ZVRvRGlzaycsIGdldE1pbWVUeXBlcygpKTtcbiAgICAgICAgcHJvZmlsZS51cGRhdGVQcmVmZXJlbmNlcygpO1xuXG4gICAgICAgIGNhcGFiaWxpdGllc1snZmlyZWZveF9wcm9maWxlJ10gPSBhd2FpdCBwcm9taXNpZnkocHJvZmlsZS5lbmNvZGVkKS5iaW5kKHByb2ZpbGUpKCk7XG4gICAgfSxcblxuICAgIGFzeW5jIF9lbmNvZGVGaXJlZm94UHJvZmlsZSAocHJvZmlsZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgcHJvZmlsZS5lbmNvZGVkKGZ1bmN0aW9uIChlcnIsIGVuY29kZWRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycilcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGVuY29kZWRQcm9maWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gUmVxdWlyZWQgLSBtdXN0IGJlIGltcGxlbWVudGVkXG4gICAgLy8gQnJvd3NlciBjb250cm9sXG4gICAgYXN5bmMgb3BlbkJyb3dzZXIgKGlkLCBwYWdlVXJsLCBicm93c2VyTmFtZSkge1xuICAgICAgICBjb25zdCBjYXBhYmlsaXRpZXMgPSB7XG4gICAgICAgICAgICAuLi50aGlzLl9nZW5lcmF0ZUJhc2ljQ2FwYWJpbGl0aWVzKGJyb3dzZXJOYW1lKSxcbiAgICAgICAgICAgIC4uLnRoaXMuX2dldEFkZGl0aW9uYWxDYXBhYmlsaXRpZXMoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNhcGFiaWxpdGllcy5sb2NhbCAgICAgICAgICAgPSBpc0xvY2FsRW5hYmxlZCgpO1xuXG4gICAgICAgIC8vIEdpdmUgcHJlZmVyZW5jZSB0byB0aGUgYWxyZWFkeSBydW5uaW5nIGxvY2FsIGlkZW50aWZpZXJcbiAgICAgICAgY2FwYWJpbGl0aWVzLmxvY2FsSWRlbnRpZmllciA9IHByb2Nlc3MuZW52LkJST1dTRVJTVEFDS19MT0NBTF9JREVOVElGSUVSO1xuXG4gICAgICAgIGlmIChjYXBhYmlsaXRpZXMubG9jYWwgJiYgIWNhcGFiaWxpdGllcy5sb2NhbElkZW50aWZpZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3RvciA9IGF3YWl0IHRoaXMuX2NyZWF0ZUNvbm5lY3RvcigpO1xuXG4gICAgICAgICAgICBjYXBhYmlsaXRpZXMubG9jYWxJZGVudGlmaWVyID0gY29ubmVjdG9yLmNvbm5lY3Rvckluc3RhbmNlLmxvY2FsSWRlbnRpZmllckZsYWc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2FwYWJpbGl0aWVzLm9zLnRvTG93ZXJDYXNlKCkgPT09ICdhbmRyb2lkJykge1xuICAgICAgICAgICAgY29uc3QgcGFyc2VkUGFnZVVybCA9IHBhcnNlVXJsKHBhZ2VVcmwpO1xuICAgICAgICAgICAgY29uc3QgYnJvd3NlclByb3h5ICA9IGF3YWl0IHRoaXMuX2dldEJyb3dzZXJQcm94eShwYXJzZWRQYWdlVXJsLmhvc3RuYW1lLCBwYXJzZWRQYWdlVXJsLnBvcnQpO1xuXG4gICAgICAgICAgICBwYWdlVXJsID0gJ2h0dHA6Ly8nICsgYnJvd3NlclByb3h5LnRhcmdldEhvc3QgKyAnOicgKyBicm93c2VyUHJveHkucHJveHlQb3J0ICsgcGFyc2VkUGFnZVVybC5wYXRoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjYXBhYmlsaXRpZXMubmFtZSlcbiAgICAgICAgICAgIGNhcGFiaWxpdGllcy5uYW1lID0gYFRlc3RDYWZlIHRlc3QgcnVuICR7aWR9YDtcblxuICAgICAgICBpZiAoYnJvd3Nlck5hbWUuaW5jbHVkZXMoJ2Nocm9tZScpKVxuICAgICAgICAgICAgdGhpcy5fcHJlcGFyZUNocm9tZUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXMpO1xuXG4gICAgICAgIGlmIChicm93c2VyTmFtZS5pbmNsdWRlcygnZmlyZWZveCcpKVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fcHJlcGFyZUZpcmVmb3hDYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmJhY2tlbmQub3BlbkJyb3dzZXIoaWQsIHBhZ2VVcmwsIGNhcGFiaWxpdGllcyk7XG5cbiAgICAgICAgdGhpcy5zZXRVc2VyQWdlbnRNZXRhSW5mbyhpZCwgdGhpcy5iYWNrZW5kLmdldFNlc3Npb25VcmwoaWQpKTtcbiAgICB9LFxuXG4gICAgYXN5bmMgY2xvc2VCcm93c2VyIChpZCkge1xuICAgICAgICBhd2FpdCB0aGlzLmJhY2tlbmQuY2xvc2VCcm93c2VyKGlkKTtcbiAgICB9LFxuXG4gICAgLy8gT3B0aW9uYWwgLSBpbXBsZW1lbnQgbWV0aG9kcyB5b3UgbmVlZCwgcmVtb3ZlIG90aGVyIG1ldGhvZHNcbiAgICAvLyBJbml0aWFsaXphdGlvblxuICAgIGFzeW5jIGluaXQgKCkge1xuICAgICAgICB2YXIgcmVwb3J0V2FybmluZyA9ICguLi5hcmdzKSA9PiB0aGlzLnJlcG9ydFdhcm5pbmcoLi4uYXJncyk7XG5cbiAgICAgICAgdGhpcy5iYWNrZW5kID0gaXNBdXRvbWF0ZUVuYWJsZWQoKSA/IG5ldyBBdXRvbWF0ZUJhY2tlbmQocmVwb3J0V2FybmluZykgOiBuZXcgSlNUZXN0aW5nQmFja2VuZChyZXBvcnRXYXJuaW5nKTtcblxuICAgICAgICBhd2FpdCB0aGlzLl9nZXREZXZpY2VMaXN0KCk7XG5cbiAgICAgICAgdGhpcy5fZ2VuZXJhdGVCcm93c2VyTmFtZXMoKTtcbiAgICB9LFxuXG4gICAgYXN5bmMgZGlzcG9zZSAoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuX2Rpc3Bvc2VDb25uZWN0b3IoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5fZGlzcG9zZUJyb3dzZXJQcm94eSgpO1xuICAgIH0sXG5cblxuICAgIC8vIEJyb3dzZXIgbmFtZXMgaGFuZGxpbmdcbiAgICBhc3luYyBnZXRCcm93c2VyTGlzdCAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJyb3dzZXJOYW1lcztcbiAgICB9LFxuXG4gICAgYXN5bmMgaXNWYWxpZEJyb3dzZXJOYW1lIChicm93c2VyTmFtZSkge1xuICAgICAgICByZXR1cm4gcGFyc2VDYXBhYmlsaXRpZXMoYnJvd3Nlck5hbWUpLmxlbmd0aCA9PT0gMSAmJiAhIXRoaXMuX2ZpbHRlclBsYXRmb3JtSW5mbyh0aGlzLl9jcmVhdGVRdWVyeShicm93c2VyTmFtZSkpLmxlbmd0aDtcbiAgICB9LFxuXG5cbiAgICAvLyBFeHRyYSBtZXRob2RzXG4gICAgYXN5bmMgcmVzaXplV2luZG93IChpZCwgd2lkdGgsIGhlaWdodCwgY3VycmVudFdpZHRoLCBjdXJyZW50SGVpZ2h0KSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYmFja2VuZC5yZXNpemVXaW5kb3coaWQsIHdpZHRoLCBoZWlnaHQsIGN1cnJlbnRXaWR0aCwgY3VycmVudEhlaWdodCk7XG4gICAgfSxcblxuICAgIGFzeW5jIG1heGltaXplV2luZG93IChpZCkge1xuICAgICAgICBhd2FpdCB0aGlzLmJhY2tlbmQubWF4aW1pemVXaW5kb3coaWQpO1xuICAgIH0sXG5cblxuICAgIGFzeW5jIHRha2VTY3JlZW5zaG90IChpZCwgc2NyZWVuc2hvdFBhdGgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5iYWNrZW5kLnRha2VTY3JlZW5zaG90KGlkLCBzY3JlZW5zaG90UGF0aCk7XG4gICAgfSxcblxuICAgIGFzeW5jIHJlcG9ydEpvYlJlc3VsdCAoaWQsIGpvYlJlc3VsdCwgam9iRGF0YSkge1xuICAgICAgICBhd2FpdCB0aGlzLmJhY2tlbmQucmVwb3J0Sm9iUmVzdWx0KGlkLCBqb2JSZXN1bHQsIGpvYkRhdGEsIHRoaXMuSk9CX1JFU1VMVCk7XG4gICAgfVxufTtcbiJdfQ==